(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23312,e=>{"use strict";e.s(["DeploymentProvider",()=>o,"useDeployment",()=>i]);var t=e.i(43476),n=e.i(71645);let r=(0,n.createContext)(void 0),a={user:null,questionnaire:null,application:null,containers:[],resources:null,environment:null,domain:null,cost:null,deployed:!1,project:null,activeEnvironmentId:null};function o(e){let{children:o}=e,[i,s]=(0,n.useState)(()=>{{let a=localStorage.getItem("unhazzle-deployment-state");if(a)try{let o=JSON.parse(a),i=o.containers||[],s=o.project;if(o.deployed&&!s&&i.length>0){var e,t,n,r;let a=new Date().toISOString(),c=(null==(e=o.questionnaire)?void 0:e.appType)?"".concat(o.questionnaire.appType.toLowerCase(),"-app"):"my-app",l=i.filter(e=>"public"===e.exposure).map(e=>e.name);s={id:"proj-"+Date.now(),name:(null==(t=o.questionnaire)?void 0:t.appType)?"".concat(o.questionnaire.appType," Application"):"My Application",slug:c,createdAt:a,updatedAt:a,prEnvs:{enabled:!0,maxEnvs:3,lifetimeHours:2,autoDeleteOnPRClose:!0},environments:[{id:"env-dev-"+Date.now(),name:"dev",slug:"dev",type:"standard",status:"active",createdAt:a,baseDomain:"dev.".concat(c,".demo.unhazzle.io"),publicContainers:l,containers:i,database:null==(n=o.resources)?void 0:n.database,cache:null==(r=o.resources)?void 0:r.cache}],envCount:1,prEnvCount:0,standardEnvCount:1}}return{...o,containers:i,project:s}}catch(e){console.error("Failed to parse saved state:",e)}}return a}),c=e=>{if(!i.project)throw Error("Cannot create environment without a project");let t=new Date().toISOString(),n=e.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),r=(e.containers||[]).filter(e=>"public"===e.exposure).map(e=>e.name),a={id:"env-".concat(n,"-").concat(Date.now()),slug:n,type:e.type||"standard",status:e.status||"provisioning",createdAt:t,baseDomain:"".concat(n,".").concat(i.project.slug,".demo.unhazzle.io"),publicContainers:r,containers:e.containers||[],database:e.database,cache:e.cache,...e,name:e.name};return s(e=>{if(!e.project)return e;let n=[...e.project.environments,a],r=n.filter(e=>"pr"===e.type).length,o=n.filter(e=>"standard"===e.type).length,i={...e.project,environments:n,envCount:n.length,prEnvCount:r,standardEnvCount:o,updatedAt:t},s={...e,project:i,activeEnvironmentId:a.id};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s}),a},l=(e,t)=>{s(n=>{if(!n.project)return n;let r=n.project.environments.map(n=>{if(n.id===e){let e={...n,...t};return t.containers&&(e.publicContainers=t.containers.filter(e=>"public"===e.exposure).map(e=>e.name)),e}return n}),a={...n.project,environments:r,updatedAt:new Date().toISOString()},o={...n,project:a};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(o)),o})};return(0,t.jsx)(r.Provider,{value:{state:i,updateUser:e=>{s(t=>{let n={...t,user:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateQuestionnaire:e=>{s(t=>{let n={...t,questionnaire:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateApplication:e=>{s(t=>{let n={...t,application:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},addContainer:e=>{s(t=>{let n=t.containers||[],r={...t,containers:[...n,e]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(r)),r})},clearContainers:()=>{s(e=>{let t={...e,containers:[]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(t)),t})},updateContainer:(e,t)=>{s(n=>{var r,a;let o=(n.containers||[]).map(n=>n.id===e?{...n,...t}:n),i=n.project;(null==(a=n.project)||null==(r=a.environments)?void 0:r[0])&&(i={...n.project,environments:n.project.environments.map((e,t)=>0===t?{...e,containers:o}:e)});let s={...n,containers:o,project:i};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s})},removeContainer:e=>{s(t=>{var n,r;let a=(t.containers||[]).filter(t=>t.id!==e),o=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(o={...t.project,environments:t.project.environments.map((e,t)=>0===t?{...e,containers:a}:e)});let i={...t,containers:a,project:o};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(i)),i})},updateResources:e=>{s(t=>{var n,r;let a=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(a={...t.project,environments:t.project.environments.map((t,n)=>0===n?{...t,database:e.database,cache:e.cache}:t)});let o={...t,resources:e,project:a};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(o)),o})},updateEnvironment:e=>{s(t=>{let n={...t,environment:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateDomain:e=>{s(t=>{let n={...t,domain:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateCost:e=>{s(t=>{let n={...t,cost:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},markDeployed:()=>{s(e=>{var t,n,r,a,o,i,s,c,l;let p=new Date().toISOString(),u=(null==(t=e.questionnaire)?void 0:t.appType)?"".concat(e.questionnaire.appType.toLowerCase(),"-app"):"my-app",d=(e.containers||[]).filter(e=>"public"===e.exposure).map(e=>e.name),m={id:"env-dev-"+Date.now(),name:"dev",slug:"dev",type:"standard",status:"active",createdAt:p,baseDomain:"dev.".concat(u,".demo.unhazzle.io"),publicContainers:d,containers:e.containers||[],database:null==(n=e.resources)?void 0:n.database,cache:null==(r=e.resources)?void 0:r.cache},v=JSON.parse(JSON.stringify(e.containers||[])).map(e=>({...e,id:e.id+"-staging",resources:{...e.resources,cpu:"2",memory:"4096",replicas:{min:2,max:10}}})),g={id:"env-staging-"+Date.now(),name:"staging",slug:"staging",type:"standard",status:"active",createdAt:new Date(Date.now()-6048e5).toISOString(),baseDomain:"staging.".concat(u,".demo.unhazzle.io"),publicContainers:d,containers:v,database:null==(a=e.resources)?void 0:a.database,cache:null==(o=e.resources)?void 0:o.cache},S=JSON.parse(JSON.stringify(e.containers||[])).map((e,t)=>({...e,id:e.id+"-pr42",resources:{...e.resources,cpu:"0.5",memory:"512",replicas:{min:1,max:1}}})),y={id:"env-pr-42-"+Date.now(),name:"fix-checkout-pr-42",slug:"fix-checkout-pr-42",type:"pr",status:"active",createdAt:new Date(Date.now()-18e5).toISOString(),expiresAt:new Date(Date.now()+54e5).toISOString(),baseDomain:"fix-checkout-pr-42.".concat(u,".demo.unhazzle.io"),publicContainers:d,containers:S,database:(null==(i=e.resources)?void 0:i.database)?{...e.resources.database,storage:"20 GB"}:void 0,cache:(null==(s=e.resources)?void 0:s.cache)?{...e.resources.cache,memory:"128 MB"}:void 0,prSource:{provider:"github",repository:"acme/shop-frontend",prNumber:42,prTitle:"Fix checkout flow validation",branchName:"fix/checkout-validation",commitSha:"a3b4c5d"},triggeredBy:"pull_request_opened",serviceOverride:{serviceName:d[0]||"frontend",image:"ghcr.io/acme/shop-frontend:pr-42-a3b4c5d"}},h={id:"proj-"+Date.now(),name:(null==(c=e.questionnaire)?void 0:c.appType)?"".concat(e.questionnaire.appType," Application"):"My Application",slug:u,description:"A production-ready application deployed with Unhazzle",createdAt:new Date(Date.now()-2592e6).toISOString(),updatedAt:p,repository:{url:"https://github.com/".concat((null==(l=e.user)?void 0:l.githubUsername)||"username","/").concat(u),branch:"main",autoDeployEnabled:!0,configPath:"unhazzle.yaml"},prEnvironmentSettings:{enabled:!0,autoCreateOnPR:!0,autoDeleteOnMerge:!0,expirationHours:72,nameTemplate:"pr-{number}"},prEnvs:{enabled:!0,maxEnvs:3,lifetimeHours:2,autoDeleteOnPRClose:!0},environments:[m,g,y],envCount:3,prEnvCount:1,standardEnvCount:2},f={...e,deployed:!0,project:h};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(f)),f})},resetState:()=>{s(a),localStorage.removeItem("unhazzle-deployment-state")},removeDatabase:()=>{s(e=>{var t,n,r;let a=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.database))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_POSTGRES_URL"!==e.key&&"DATABASE_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,database:!1},environmentVariables:n}}),o=e.resources?{...e.resources,database:void 0}:e.resources,i=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(i={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"DATABASE_URL"!==e.key)});let s=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(s={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:a,database:void 0}:e)});let c={...e,containers:a,resources:o,environment:i,project:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(c)),c})},removeCache:()=>{s(e=>{var t,n,r;let a=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.cache))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_REDIS_URL"!==e.key&&"REDIS_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,cache:!1},environmentVariables:n}}),o=e.resources?{...e.resources,cache:void 0}:e.resources,i=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(i={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"REDIS_URL"!==e.key)});let s=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(s={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:a,cache:void 0}:e)});let c={...e,containers:a,resources:o,environment:i,project:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(c)),c})},updateProject:e=>{s(t=>{if(!t.project)return t;let n={...t.project,...e,updatedAt:new Date().toISOString()},r={...t,project:n};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(r)),r})},createEnvironment:c,updateEnvironmentConfig:l,deleteEnvironment:e=>{s(t=>{if(!t.project)return t;let n=new Date().toISOString(),r=t.project.environments.map(t=>t.id===e?{...t,status:"deleted"}:t),a=r.filter(e=>"pr"===e.type&&"deleted"!==e.status).length,o=r.filter(e=>"standard"===e.type&&"deleted"!==e.status).length,i={...t.project,environments:r,envCount:a+o,prEnvCount:a,standardEnvCount:o,updatedAt:n},s=t.activeEnvironmentId===e?null:t.activeEnvironmentId,c={...t,project:i,activeEnvironmentId:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(c)),c})},cloneEnvironment:(e,t)=>{if(!i.project)throw Error("Cannot clone environment without a project");let n=i.project.environments.find(t=>t.id===e);if(!n)throw Error("Source environment not found");return c({name:t,type:"standard",containers:JSON.parse(JSON.stringify(n.containers)),database:n.database?JSON.parse(JSON.stringify(n.database)):void 0,cache:n.cache?JSON.parse(JSON.stringify(n.cache)):void 0})},promoteEnvironment:(e,t)=>{if(!i.project)throw Error("Cannot promote without a project");let n=i.project.environments.find(t=>t.id===e),r=i.project.environments.find(e=>e.id===t);if(!n||!r)throw Error("Source or target environment not found");l(t,{containers:JSON.parse(JSON.stringify(n.containers)),database:n.database?JSON.parse(JSON.stringify(n.database)):void 0,cache:n.cache?JSON.parse(JSON.stringify(n.cache)):void 0,status:"provisioning"}),setTimeout(()=>{l(t,{status:"active"})},100)},pauseEnvironment:e=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"active"===t.status?{...t,status:"paused"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},a={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})},resumeEnvironment:e=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"paused"===t.status?{...t,status:"provisioning"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},a={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),setTimeout(()=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"provisioning"===t.status?{...t,status:"active"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},a={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})},2e3),a})},setActiveEnvironment:e=>{s(t=>{let n={...t,activeEnvironmentId:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},getActiveEnvironment:()=>i.project&&i.activeEnvironmentId&&i.project.environments.find(e=>e.id===i.activeEnvironmentId)||null},children:o})}function i(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useDeployment must be used within a DeploymentProvider");return e}}]);