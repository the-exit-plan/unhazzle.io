(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23312,e=>{"use strict";e.s(["DeploymentProvider",()=>a,"useDeployment",()=>i]);var t=e.i(43476),n=e.i(71645);let r=(0,n.createContext)(void 0),o={user:null,questionnaire:null,application:null,containers:[],resources:null,environment:null,domain:null,cost:null,deployed:!1,project:null,activeEnvironmentId:null};function a(e){let{children:a}=e,[i,s]=(0,n.useState)(()=>{{let o=localStorage.getItem("unhazzle-deployment-state");if(o)try{let a=JSON.parse(o),i=a.containers||[],s=a.project;if(a.deployed&&!s&&i.length>0){var e,t,n,r;let o=new Date().toISOString(),l=(null==(e=a.questionnaire)?void 0:e.appType)?"".concat(a.questionnaire.appType.toLowerCase(),"-app"):"my-app",c=i.filter(e=>"public"===e.exposure).map(e=>e.name);s={id:"proj-"+Date.now(),name:(null==(t=a.questionnaire)?void 0:t.appType)?"".concat(a.questionnaire.appType," Application"):"My Application",slug:l,createdAt:o,updatedAt:o,prEnvs:{enabled:!0,maxEnvs:3,lifetimeHours:2,autoDeleteOnPRClose:!0},environments:[{id:"env-dev-"+Date.now(),name:"dev",slug:"dev",type:"standard",status:"active",createdAt:o,baseDomain:"dev.".concat(l,".demo.unhazzle.io"),publicContainers:c,containers:i,database:null==(n=a.resources)?void 0:n.database,cache:null==(r=a.resources)?void 0:r.cache}],envCount:1,prEnvCount:0,standardEnvCount:1}}return{...a,containers:i,project:s}}catch(e){console.error("Failed to parse saved state:",e)}}return o}),l=e=>{if(!i.project)throw Error("Cannot create environment without a project");let t=new Date().toISOString(),n=e.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),r=(e.containers||[]).filter(e=>"public"===e.exposure).map(e=>e.name),o={id:"env-".concat(n,"-").concat(Date.now()),slug:n,type:e.type||"standard",status:e.status||"provisioning",createdAt:t,baseDomain:"".concat(n,".").concat(i.project.slug,".demo.unhazzle.io"),publicContainers:r,containers:e.containers||[],database:e.database,cache:e.cache,...e,name:e.name};return s(e=>{if(!e.project)return e;let n=[...e.project.environments,o],r=n.filter(e=>"pr"===e.type).length,a=n.filter(e=>"standard"===e.type).length,i={...e.project,environments:n,envCount:n.length,prEnvCount:r,standardEnvCount:a,updatedAt:t},s={...e,project:i,activeEnvironmentId:o.id};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s}),o},c=(e,t)=>{s(n=>{if(!n.project)return n;let r=n.project.environments.map(n=>{if(n.id===e){let e={...n,...t};return t.containers&&(e.publicContainers=t.containers.filter(e=>"public"===e.exposure).map(e=>e.name)),e}return n}),o={...n.project,environments:r,updatedAt:new Date().toISOString()},a={...n,project:o};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})};return(0,t.jsx)(r.Provider,{value:{state:i,updateUser:e=>{s(t=>{let n={...t,user:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateQuestionnaire:e=>{s(t=>{let n={...t,questionnaire:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateApplication:e=>{s(t=>{let n={...t,application:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},addContainer:e=>{s(t=>{let n=t.containers||[],r={...t,containers:[...n,e]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(r)),r})},clearContainers:()=>{s(e=>{let t={...e,containers:[]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(t)),t})},updateContainer:(e,t)=>{s(n=>{var r,o;let a=(n.containers||[]).map(n=>n.id===e?{...n,...t}:n),i=n.project;(null==(o=n.project)||null==(r=o.environments)?void 0:r[0])&&(i={...n.project,environments:n.project.environments.map((e,t)=>0===t?{...e,containers:a}:e)});let s={...n,containers:a,project:i};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s})},removeContainer:e=>{s(t=>{var n,r;let o=(t.containers||[]).filter(t=>t.id!==e),a=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(a={...t.project,environments:t.project.environments.map((e,t)=>0===t?{...e,containers:o}:e)});let i={...t,containers:o,project:a};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(i)),i})},updateResources:e=>{s(t=>{var n,r;let o=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(o={...t.project,environments:t.project.environments.map((t,n)=>0===n?{...t,database:e.database,cache:e.cache}:t)});let a={...t,resources:e,project:o};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})},updateEnvironment:e=>{s(t=>{let n={...t,environment:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateDomain:e=>{s(t=>{let n={...t,domain:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateCost:e=>{s(t=>{let n={...t,cost:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},markDeployed:()=>{s(e=>{var t,n,r;let o=new Date().toISOString(),a=Date.now(),i="Project ".concat(a.toString().slice(-6)),s="project-".concat(a.toString().slice(-6)),l=(e.containers||[]).filter(e=>"public"===e.exposure).map(e=>e.name),c={id:"env-dev-"+a,name:"dev",slug:"dev",type:"standard",status:"active",createdAt:o,baseDomain:"dev.".concat(s,".demo.unhazzle.io"),publicContainers:l,containers:e.containers||[],database:null==(t=e.resources)?void 0:t.database,cache:null==(n=e.resources)?void 0:n.cache},u={id:"proj-"+a,name:i,slug:s,description:"A production-ready application deployed with Unhazzle",createdAt:o,updatedAt:o,repository:{url:"https://github.com/".concat((null==(r=e.user)?void 0:r.githubUsername)||"username","/").concat(s),branch:"main",autoDeployEnabled:!0,configPath:"unhazzle.yaml"},prEnvironmentSettings:{enabled:!1,autoCreateOnPR:!0,autoDeleteOnMerge:!0,expirationHours:72,nameTemplate:"pr-{number}"},prEnvs:{enabled:!1,maxEnvs:3,lifetimeHours:2,autoDeleteOnPRClose:!0},environments:[c],envCount:1,prEnvCount:0,standardEnvCount:1},p={...e,deployed:!0,project:u};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(p)),p})},resetState:()=>{s(o),localStorage.removeItem("unhazzle-deployment-state")},removeDatabase:()=>{s(e=>{var t,n,r;let o=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.database))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_POSTGRES_URL"!==e.key&&"DATABASE_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,database:!1},environmentVariables:n}}),a=e.resources?{...e.resources,database:void 0}:e.resources,i=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(i={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"DATABASE_URL"!==e.key)});let s=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(s={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:o,database:void 0}:e)});let l={...e,containers:o,resources:a,environment:i,project:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(l)),l})},removeCache:()=>{s(e=>{var t,n,r;let o=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.cache))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_REDIS_URL"!==e.key&&"REDIS_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,cache:!1},environmentVariables:n}}),a=e.resources?{...e.resources,cache:void 0}:e.resources,i=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(i={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"REDIS_URL"!==e.key)});let s=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(s={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:o,cache:void 0}:e)});let l={...e,containers:o,resources:a,environment:i,project:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(l)),l})},updateProject:e=>{s(t=>{if(!t.project)return t;let n={...t.project,...e,updatedAt:new Date().toISOString()},r={...t,project:n};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(r)),r})},createEnvironment:l,updateEnvironmentConfig:c,deleteEnvironment:e=>{s(t=>{if(!t.project)return t;let n=new Date().toISOString(),r=t.project.environments.map(t=>t.id===e?{...t,status:"deleted"}:t),o=r.filter(e=>"pr"===e.type&&"deleted"!==e.status).length,a=r.filter(e=>"standard"===e.type&&"deleted"!==e.status).length,i={...t.project,environments:r,envCount:o+a,prEnvCount:o,standardEnvCount:a,updatedAt:n},s=t.activeEnvironmentId===e?null:t.activeEnvironmentId,l={...t,project:i,activeEnvironmentId:s};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(l)),l})},cloneEnvironment:(e,t)=>{if(!i.project)throw Error("Cannot clone environment without a project");let n=i.project.environments.find(t=>t.id===e);if(!n)throw Error("Source environment not found");return l({name:t,type:"standard",containers:JSON.parse(JSON.stringify(n.containers)),database:n.database?JSON.parse(JSON.stringify(n.database)):void 0,cache:n.cache?JSON.parse(JSON.stringify(n.cache)):void 0})},promoteEnvironment:(e,t)=>{if(!i.project)throw Error("Cannot promote without a project");let n=i.project.environments.find(t=>t.id===e),r=i.project.environments.find(e=>e.id===t);if(!n||!r)throw Error("Source or target environment not found");c(t,{containers:JSON.parse(JSON.stringify(n.containers)),database:n.database?JSON.parse(JSON.stringify(n.database)):void 0,cache:n.cache?JSON.parse(JSON.stringify(n.cache)):void 0,status:"provisioning"}),setTimeout(()=>{c(t,{status:"active"})},100)},pauseEnvironment:e=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"active"===t.status?{...t,status:"paused"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},o={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(o)),o})},resumeEnvironment:e=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"paused"===t.status?{...t,status:"provisioning"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},o={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(o)),setTimeout(()=>{s(t=>{if(!t.project)return t;let n=t.project.environments.map(t=>t.id===e&&"provisioning"===t.status?{...t,status:"active"}:t),r={...t.project,environments:n,updatedAt:new Date().toISOString()},o={...t,project:r};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(o)),o})},2e3),o})},setActiveEnvironment:e=>{s(t=>{let n={...t,activeEnvironmentId:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},getActiveEnvironment:()=>i.project&&i.activeEnvironmentId&&i.project.environments.find(e=>e.id===i.activeEnvironmentId)||null},children:a})}function i(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useDeployment must be used within a DeploymentProvider");return e}}]);