(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23312,e=>{"use strict";e.s(["DeploymentProvider",()=>a,"useDeployment",()=>l]);var t=e.i(43476),n=e.i(71645);let r=(0,n.createContext)(void 0),o={user:null,questionnaire:null,application:null,containers:[],resources:null,environment:null,domain:null,cost:null,deployed:!1,project:null};function a(e){let{children:a}=e,[l,i]=(0,n.useState)(()=>{{let r=localStorage.getItem("unhazzle-deployment-state");if(r)try{let o=JSON.parse(r),a=o.containers||[],l=o.project;if(o.deployed&&!l&&a.length>0){var e,t,n;l={id:"proj-"+Date.now(),name:(null==(e=o.questionnaire)?void 0:e.appType)?"".concat(o.questionnaire.appType," Application"):"My Application",environments:[{id:"env-dev-"+Date.now(),name:"dev",containers:a,database:null==(t=o.resources)?void 0:t.database,cache:null==(n=o.resources)?void 0:n.cache}]}}return{...o,containers:a,project:l}}catch(e){console.error("Failed to parse saved state:",e)}}return o});return(0,t.jsx)(r.Provider,{value:{state:l,updateUser:e=>{i(t=>{let n={...t,user:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateQuestionnaire:e=>{i(t=>{let n={...t,questionnaire:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateApplication:e=>{i(t=>{let n={...t,application:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},addContainer:e=>{i(t=>{let n=t.containers||[],r={...t,containers:[...n,e]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(r)),r})},clearContainers:()=>{i(e=>{let t={...e,containers:[]};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(t)),t})},updateContainer:(e,t)=>{i(n=>{var r,o;let a=(n.containers||[]).map(n=>n.id===e?{...n,...t}:n),l=n.project;(null==(o=n.project)||null==(r=o.environments)?void 0:r[0])&&(l={...n.project,environments:n.project.environments.map((e,t)=>0===t?{...e,containers:a}:e)});let i={...n,containers:a,project:l};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(i)),i})},removeContainer:e=>{i(t=>{var n,r;let o=(t.containers||[]).filter(t=>t.id!==e),a=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(a={...t.project,environments:t.project.environments.map((e,t)=>0===t?{...e,containers:o}:e)});let l={...t,containers:o,project:a};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(l)),l})},updateResources:e=>{i(t=>{var n,r;let o=t.project;(null==(r=t.project)||null==(n=r.environments)?void 0:n[0])&&(o={...t.project,environments:t.project.environments.map((t,n)=>0===n?{...t,database:e.database,cache:e.cache}:t)});let a={...t,resources:e,project:o};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})},updateEnvironment:e=>{i(t=>{let n={...t,environment:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateDomain:e=>{i(t=>{let n={...t,domain:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},updateCost:e=>{i(t=>{let n={...t,cost:e};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(n)),n})},markDeployed:()=>{i(e=>{var t,n,r;let o={id:"proj-"+Date.now(),name:(null==(t=e.questionnaire)?void 0:t.appType)?"".concat(e.questionnaire.appType," Application"):"My Application",environments:[{id:"env-dev-"+Date.now(),name:"dev",containers:e.containers||[],database:null==(n=e.resources)?void 0:n.database,cache:null==(r=e.resources)?void 0:r.cache}]},a={...e,deployed:!0,project:o};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(a)),a})},resetState:()=>{i(o),localStorage.removeItem("unhazzle-deployment-state")},removeDatabase:()=>{i(e=>{var t,n,r;let o=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.database))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_POSTGRES_URL"!==e.key&&"DATABASE_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,database:!1},environmentVariables:n}}),a=e.resources?{...e.resources,database:void 0}:e.resources,l=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(l={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"DATABASE_URL"!==e.key)});let i=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(i={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:o,database:void 0}:e)});let s={...e,containers:o,resources:a,environment:l,project:i};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s})},removeCache:()=>{i(e=>{var t,n,r;let o=(e.containers||[]).map(e=>{var t;if(!(null==(t=e.serviceAccess)?void 0:t.cache))return e;let n=(e.environmentVariables||[]).filter(e=>"UNHAZZLE_REDIS_URL"!==e.key&&"REDIS_URL"!==e.key);return{...e,serviceAccess:{...e.serviceAccess,cache:!1},environmentVariables:n}}),a=e.resources?{...e.resources,cache:void 0}:e.resources,l=e.environment;(null==(t=e.environment)?void 0:t.autoGenerated)&&(l={...e.environment,autoGenerated:e.environment.autoGenerated.filter(e=>"REDIS_URL"!==e.key)});let i=e.project;(null==(r=e.project)||null==(n=r.environments)?void 0:n[0])&&(i={...e.project,environments:e.project.environments.map((e,t)=>0===t?{...e,containers:o,cache:void 0}:e)});let s={...e,containers:o,resources:a,environment:l,project:i};return localStorage.setItem("unhazzle-deployment-state",JSON.stringify(s)),s})}},children:a})}function l(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useDeployment must be used within a DeploymentProvider");return e}}]);